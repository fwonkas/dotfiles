#!/bin/bash

# WARNING: Do not edit this file.
# It was generated by processing {{ yadm.source }}

# Save this file as ~/.config/yadm/bootstrap and make it executable. It will
# execute all executable files (excluding templates and editor backups) in the
# ~/.config/yadm/bootstrap.d directory when run.

set -eu

# Directory to look for bootstrap executables in
BOOTSTRAP_D="${BASH_SOURCE[0]}.d"

if [[ ! -d "$BOOTSTRAP_D" ]]; then
    echo "Error: bootstrap directory '$BOOTSTRAP_D' not found" >&2
    exit 1
fi

# This will execute all executable files (excluding templates and editor
# backups) in the $BOOTSTRAP_D directory when run.

find -L "$BOOTSTRAP_D" -type f | sort | while IFS= read -r bootstrap; do
    if [[ -x "$bootstrap" && ! "$bootstrap" =~ "##" && ! "$bootstrap" =~ "~$" ]]; then
        if ! "$bootstrap"; then
            echo "Error: bootstrap '$bootstrap' failed" >&2
            exit 1
        fi
    fi
done

hash -r

{% if yadm.class == "Work" %}
YARN=$(brew --prefix yarn)/bin/yarn

if (command -v "$YARN" >/dev/null 2>&1); then
    # Install yalc. Needed for local-publish
    echo "Installing yalc..."
    if ! $YARN global add yalc; then
        echo "Failed to install yalc" >&2
    else
        echo "Successfully installed yalc"
    fi
fi
{% endif %}